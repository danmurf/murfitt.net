{{- /* Head custom content area start */ -}}

{{- if hugo.IsProduction | or (eq site.Params.env "production") }}
<!-- Google Consent Mode v2 -->
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}

// Set default consent to 'denied' as a placeholder
gtag('consent', 'default', {
  'analytics_storage': 'denied',
  'ad_storage': 'denied',
  'ad_user_data': 'denied',
  'ad_personalization': 'denied',
  'functionality_storage': 'denied',
  'personalization_storage': 'denied',
  'security_storage': 'granted'
});

// Check if user has already made a choice
const analyticsConsent = localStorage.getItem('analytics_consent');
if (analyticsConsent === 'granted') {
  gtag('consent', 'update', {
    'analytics_storage': 'granted'
  });
}
</script>

{{- if site.GoogleAnalytics }}
<!-- Google Analytics GA4 -->
<script async src="https://www.googletagmanager.com/gtag/js?id={{ site.GoogleAnalytics }}"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', '{{ site.GoogleAnalytics }}', {
  'anonymize_ip': true
});
</script>
{{- end }}
{{- end }}

{{- /* Head custom content area end */ -}}